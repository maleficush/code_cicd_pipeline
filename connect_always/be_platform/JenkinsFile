pipeline {
    agent any
    environment {
        git_repo = ""
    }

    stages() {
        stage('init') {
            steps() {
                echo 'init'
                sh 'printenv'

                script {
                    switch(env.PROFILE) {
                        case 'ch-stg':
                            git_repo = 'https://${env.CL_REPO_TOKEN}@github.com/codeclick-company/codeclick_connectalways_be.git'
                            break
                        case 'ca-dev':
                            git_repo = 'https://${env.CL_REPO_TOKEN}@github.com/codeclick-company/codeclick_connectalways_be.git'
                            break
                        default:
                            error('Unexpected branch name')
                    }
                }

                echo git_repo
            }
        }

        stage('Chekcout') {
            steps() {
                git credentialsId: 'CL_REPO_CREDENTIAL', url: 'https://github.com/codeclick-company/codeclick_connectalways_be.git'
                echo 'Chekcout'
            }
        }

        stage('Configure App profile config') {
            steps {
                echo 'Testing..'
                script {
                    switch(env.PROFILE) {
                        case 'ch-stg':
                            sh "cp ./src/main/resources/application-ch-stg.yml ./src/main/resources/application.yml"
                            break
                        case 'ca-dev':
                            sh "cp ./src/main/resources/application-ca-dev.yml ./src/main/resources/application.yml"
                            break
                        default:
                            error('Unexpected branch name')
                    }
                }

            }
        }

        stage('execute sh') {
            steps {
                sh "chmod 774 ./project.sh"
                sh "./project.sh"
            }
        }
    }
}