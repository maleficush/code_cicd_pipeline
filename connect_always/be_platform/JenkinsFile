pipeline {
    agent any
    environment {
        GIT_REPO = ""
        BRANCH_NAME = ""
    }

    stages() {
        stage('init') {
            steps() {
                echo 'init'


                script {
                    BRANCH_NAME = env.BRANCH_NAME

                    switch(env.PROFILE) {
                        case 'ch-stg':
                            GIT_REPO = 'https://github.com/codeclick-company/codeclick_connectalways_be.git'
                            break
                        case 'ca-dev':
                            GIT_REPO = 'https://github.com/codeclick-company/codeclick_connectalways_be.git'
                            break
                        default:
                            error('Unexpected branch name')
                    }
                }
                echo $BRANCH_NAME
                echo ${BRANCH_NAME}
                echo env.PROFILE
                echo $PROFILE

                echo BRANCH_NAME
                echo GIT_REPO
            }
        }

        stage('Chekcout') {
            steps() {
                git branch: BRANCH_NAME, credentialsId: 'CL_REPO_CREDENTIAL', url: GIT_REPO
                echo 'Chekcout'
            }
        }

        stage('Configure App profile config') {
            steps {
                echo 'Testing..'
                script {
                    switch(env.PROFILE) {
                        case 'ch-stg':
                            sh "cp ./src/main/resources/application-ch-stg.yml ./src/main/resources/application.yml"
                            break
                        case 'ca-dev':
                            sh "cp ./src/main/resources/application-ca-dev.yml ./src/main/resources/application.yml"
                            break
                        default:
                            error('Unexpected branch name')
                    }
                }

            }
        }

        stage('execute sh') {
            steps {
                sh "chmod 774 ./project.sh"
                sh "./project.sh"
            }
        }
    }
}