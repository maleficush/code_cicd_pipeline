pipeline {
    agent any
    environment {
        git_repo = ""
    }

    stages() {
        stage('init') {
            steps() {
                echo 'init'

                script {
                    switch(env.PROFILE) {
                        case 'ch-stg':
                            git_repo = 'https://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@github.com/codeclick-company/codeclick_connectalways_be.git'
                            break
                        case 'ca-dev':
                            git_repo = 'https://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@github.com/codeclick-company/codeclick_connectalways_be.git'
                            break
                        default:
                            error('Unexpected branch name')
                    }
                }

                echo git_repo
            }
        }

        stage('Source clone') {
            steps() {
                echo 'Source clone'
                script {
                    git clone 'https://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@github.com/codeclick-company/codeclick_connectalways_be.git'
                }
            }
        }

        stage('Configure App profile config') {
            steps {
                echo 'Testing..'
                script {
                    switch(env.PROFILE) {
                        case 'ch-stg':
                            sh "cp ./src/main/resources/application-ch-stg.yml ./src/main/resources/application.yml"
                            break
                        case 'ca-dev':
                            sh "cp ./src/main/resources/application-ca-dev.yml ./src/main/resources/application.yml"
                            break
                        default:
                            error('Unexpected branch name')
                    }
                }

            }
        }

        stage('execute sh') {
            steps {
                sh "chmod 774 ./project.sh"
                sh "./project.sh"
            }
        }
    }
}